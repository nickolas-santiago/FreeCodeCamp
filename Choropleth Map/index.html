<!DOCTYPE html>
<html lang="en">
<head>
    <title>Choropleth Map</title>
    <script src="http://d3js.org/d3.v5.min.js" charset="utf-8"></script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <style type="text/css">
        body
        {
            background-color: #e3e3e3;
        }
        svg
        {
            background-color: white;
        }
        #title
        {    
            font-size: 30px;
            font-weight: 600;
        }
        #tooltip
        {
            padding: 6px;
            background-color: rgba(209, 255, 237, 0.93)
        }
    </style>
    <script>
    "use strict";
    $(document).ready(function()
    {
        var svg_width = 1280;
        var svg_height = 700;
        var padding = 60;
        var chart_width = (svg_width - (2 * padding));
        var chart_height = (svg_height - (2 * padding));
        var my_counties_data;
        var url = "https://raw.githubusercontent.com/no-stack-dub-sack/testable-projects-fcc/master/src/data/choropleth_map/counties.json";
        var req = new XMLHttpRequest();
        req.open("GET",url,true);
        req.send();
        req.onload = function()
        {
            console.log("yo");
            my_counties_data = JSON.parse(req.responseText);
            var education_data;
            var education_url = "https://raw.githubusercontent.com/no-stack-dub-sack/testable-projects-fcc/master/src/data/choropleth_map/for_user_education.json";
            var req_education = new XMLHttpRequest();
            req_education.open("GET",education_url,true);
            req_education.send();
            req_education.onload = function()
            {
                education_data = JSON.parse(req_education.responseText);
                //console.log(JSON.parse(req_education.responseText));
                var chart_svg = d3.select("#chart_div")
                    .append("svg")
                    .attr("width",svg_width)
                    .attr("height",svg_height)
                    .attr("id","chart");
                var title = chart_svg.append("text")
                    .attr("id","title")
                    .text("a title")
                    .attr("x",(svg_width/2))
                    .attr("y",35)
                    .style("text-anchor", "middle");
                chart_svg.append("text")
                    .attr("id","description")
                    .text("A description")
                    .attr("x",50)
                    .attr("y",50);
                //console.log(my_counties_data);
                //console.log(my_counties_data.objects.counties.geometries);
                
                var nn = my_counties_data.objects.counties.geometries;
                //console.log(nn);
                
                var lowest_bdnum = d3.min(education_data,function(d)
                {
                    return d.bachelorsOrHigher;
                });
                var highest_bdnum = d3.max(education_data,function(d)
                {
                    return d.bachelorsOrHigher;
                });
                var reordered_education_data = [];
                nn.forEach(function(n)
                {
                    education_data.forEach(function(e)
                    {
                        if(e.fips == n.id)
                        {
                            reordered_education_data.push(e);
                        }
                    });
                })
                console.log(reordered_education_data);
                
                var tooltip = d3.select("body")
                    .append("div")
                    .attr("id","tooltip")
                    .style("position","absolute");
                
                let feature = topojson.feature(my_counties_data, my_counties_data.objects.counties);
                const path = d3.geoPath();
                //console.log(path(feature));
                //console.log(feature.features);
                chart_svg.selectAll("path")
                    .data(feature.features)
                    .enter()
                    .append("path")
                    .attr("d",path)
                    .attr("class","county")
                    .attr("data-fips", function(d,i)
                    {
                        return reordered_education_data[i].fips;
                    })
                    .attr("data-education", function(d,i)
                    {
                        return reordered_education_data[i].bachelorsOrHigher;
                    })
                    .attr("fill",function(d, i)
                    {
                        if(reordered_education_data[i].bachelorsOrHigher >= (highest_bdnum - (((highest_bdnum - lowest_bdnum)/4) * 1)))
                        {
                            return "rgb(215, 48, 39)";
                        }
                        else if(reordered_education_data[i].bachelorsOrHigher >= (highest_bdnum - (((highest_bdnum - lowest_bdnum)/4) * 2)))
                        {
                            return "rgb(254, 224, 144)";
                        }
                        else if(reordered_education_data[i].bachelorsOrHigher >= (highest_bdnum - (((highest_bdnum - lowest_bdnum)/4) * 3)))
                        {
                            return "rgb(224, 243, 248)";
                        }
                        else if(reordered_education_data[i].bachelorsOrHigher >= (highest_bdnum - (((highest_bdnum - lowest_bdnum)/4) * 4)))
                        {
                            return "rgb(69, 117, 180)";
                        }
                    })
                    .on("mouseover", function(d,i)
                    {
                        tooltip.style("left", d3.event.pageX + 20 + "px")
                            .style("top", d3.event.pageY - 15 + "px")
                            .style("display", "inline-block")
                            .attr("data-education", function()
                            {
                                return reordered_education_data[i].bachelorsOrHigher;
                            })
                            .html(function()
                            {
                                var html = "";
                                html += "tooltip";
                                return html;
                            });
                    })
                    .on("mouseout", function(d,i)
                    {
                        tooltip.style("display", "none");
                    });
                var legend_rect = 70;
                var legend = d3.select("body")
                    .append("svg")
                    .attr("id","legend")
                    .attr("width", (legend_rect * 4))
                    .attr("height", legend_rect);
                legend.append("rect")
                    .attr("width", legend_rect)
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr("height", legend_rect)
                    .attr("fill","rgb(69, 117, 180)");
                legend.append("rect")
                    .attr("width", legend_rect)
                    .attr("x", 70)
                    .attr("y", 0)
                    .attr("height", legend_rect)
                    .attr("fill","rgb(224, 243, 248)");
                legend.append("rect")
                    .attr("width", legend_rect)
                    .attr("x", 140)
                    .attr("y", 0)
                    .attr("height", legend_rect)
                    .attr("fill","rgb(254, 224, 144)");
                legend.append("rect")
                    .attr("width", legend_rect)
                    .attr("x", 210)
                    .attr("y", 0)
                    .attr("height", legend_rect)
                    .attr("fill","rgb(215, 48, 39)");
            }
        }
    });
    </script>
</head>
<body>
    <div id="chart_div">
    </div>
</body>
</html>